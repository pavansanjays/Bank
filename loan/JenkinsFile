pipeline {
    agent {
          docker {
                image 'maven:3.9.6-eclipse-temurin-21' // âœ… FIX: Use a stable modern JDK (e.g., JDK 21, the current LTS)
                args '-v /var/jenkins_home/.m2:/root/.m2'  // attach docker maven folder to jenkins workspace
          }
    }
    environment{
         APP_JAR='target/*.jar'
    }

    stages {
        stage('build Stage') {
            steps {
                 echo "This is the building stage"
                 dir('loan'){
                     sh 'mvn clean install'
                 }
            }
        }

        stage('testing')
        {
            steps{
                echo "Running unit tests"
                // ðŸ’¡ FIX: Added mvn test command
                dir('loan'){
                    sh 'mvn test'
                }
            }
        }

        stage('Archive jar file'){
           steps{
              echo "This is the archiving file stage"
              dir('loan'){
                  archiveArtifacts artifacts: APP_JAR
              }
           }
        }
    }
    post{
        always{
            echo"always in post"
        }
    }
}